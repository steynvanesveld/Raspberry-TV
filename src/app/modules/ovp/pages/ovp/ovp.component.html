<input
    type="checkbox"
    name="favorites"
    id="favorites"
    [ngClass]="showFavorites ? 'active' : ''"
    [(ngModel)]="showFavorites"
    (change)="routerNavigate()"
/>

<main *ngIf="ovp" class="ovp-wrapper">
    <div class="container">
        <nav class="navbar">
            <input
                type="search"
                [(ngModel)]="query"
                (search)="routerNavigate($event)"
                placeholder="Search.."
            />
            <div>
                <select [(ngModel)]="order" (change)="routerNavigate()">
                    <option value="top-weekly">Top Weekly</option>
                    <option value="top-monthly">Top Monthly</option>
                    <option value="most-popular">Most Popular</option>
                    <option value="top-rated">Top Rated</option>
                    <option value="latest">Latest</option>
                </select>

                <select [(ngModel)]="orientation" (change)="routerNavigate()">
                    <option value="portrait">Portrait</option>
                    <option value="landscape">Landscape</option>
                </select>
            </div>
        </nav>

        <main
            class="ovp"
            #main
            *ngIf="
                (showFavorites && favoriteVideos.length) ||
                    (!showFavorites && ovp.videos?.length);
                else noResults
            "
        >
            <ng-template [ngTemplateOutlet]="pagination"></ng-template>
            <ng-container
                *ngFor="
                    let video of showFavorites ? favoriteVideos : ovp.videos
                "
            >
                <a
                    *ngIf="
                        video?.current_thumb?.src &&
                        ((orientation === 'portrait' &&
                            video.default_thumb.height >
                                video.default_thumb.width) ||
                            (orientation === 'landscape' &&
                                video.default_thumb.width >
                                    video.default_thumb.height))
                    "
                    (touchstart)="setNewThumbnail(video)"
                    (mouseenter)="setNewThumbnail(video)"
                    (mouseleave)="setDefaultThumbnail(video)"
                    href="/#/ovp/{{ video.id }}?redirect=true"
                    class="video hidden"
                >
                    <button
                        [ngClass]="[
                            'favorite-button',
                            favorites?.favorites?.includes(video.id)
                                ? 'favorite'
                                : ''
                        ]"
                        (click)="setFavorite($event, video)"
                    ></button>
                    <figure>
                        <img
                            class="thumb"
                            [src]="video.current_thumb.src"
                            (load)="showFavoriteButton($event.target)"
                            [style.aspect-ratio]="
                                video.current_thumb.width /
                                video.current_thumb.height
                            "
                        />
                        <img
                            class="background"
                            [src]="video.current_thumb.src"
                            [style.aspect-ratio]="
                                video.current_thumb.width /
                                video.current_thumb.height
                            "
                        />
                    </figure>
                    <span>{{ video.title }}</span>
                </a>
            </ng-container>
            <ng-template [ngTemplateOutlet]="pagination"></ng-template>
        </main>

        <ng-template #pagination>
            <ul
                class="ovp-pagination"
                *ngIf="ovp.total_pages > 1 && !showFavorites"
            >
                <li
                    *ngFor="
                        let item of [].constructor(ovp.total_pages)
                            | slice: 0:10;
                        let index = index
                    "
                    [ngClass]="index + 1 === page ? 'active' : ''"
                    (click)="routerNavigate(undefined, index + 1)"
                >
                    {{ index + 1 }}
                </li>
            </ul>
        </ng-template>

        <ng-template #noResults>
            <span class="no-result"> No results..</span>
        </ng-template>
    </div>
</main>
